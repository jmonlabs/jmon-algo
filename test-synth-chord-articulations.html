<!DOCTYPE html>
<html>
<head>
  <title>Synth Type & Chord Articulation Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .test-info {
      background: #333;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    h2 { margin-top: 0; }
    pre { background: #222; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Synth Type & Chord Articulation Test</h1>

  <div class="test-info">
    <h2>Test 1: Respecting Track Synth Settings</h2>
    <p>Track specifies <code>synth: "FMSynth"</code></p>
    <ul>
      <li><strong>Normal notes:</strong> Should use FMSynth (you'll hear FM timbre)</li>
      <li><strong>Articulated notes:</strong> Should use FMSynth with vibrato applied</li>
    </ul>
  </div>

  <div id="player1-container"></div>

  <div class="test-info" style="margin-top: 30px;">
    <h2>Test 2: Chord Articulations</h2>
    <p>Testing chords with vibrato/tremolo applied</p>
    <ul>
      <li><strong>Chord 1 (C-E-G):</strong> Normal chord, no articulation</li>
      <li><strong>Chord 2 (D-F#-A):</strong> Chord with vibrato (should hear pitch wobble on all notes)</li>
      <li><strong>Chord 3 (E-G#-B):</strong> Chord with tremolo (should hear volume pulsing)</li>
    </ul>
  </div>

  <div id="player2-container"></div>

  <script type="module">
    import { createPlayer } from './src/browser/music-player.js';

    // Test 1: Synth type respect
    const composition1 = {
      metadata: { title: "FMSynth Test" },
      tempo: 120,
      tracks: [
        {
          synth: "FMSynth", // Custom synth type
          events: [
            // Normal note
            {
              time: 0,
              duration: 1,
              pitch: 60, // C4
              velocity: 0.8
            },
            // Note with vibrato (should still use FMSynth)
            {
              time: 1,
              duration: 2,
              pitch: 64, // E4
              velocity: 0.8,
              articulations: [
                {
                  type: "vibrato",
                  rate: 5,
                  depth: 50
                }
              ]
            },
            // Another normal note
            {
              time: 3,
              duration: 1,
              pitch: 67, // G4
              velocity: 0.8
            }
          ]
        }
      ]
    };

    // Test 2: Chord articulations
    const composition2 = {
      metadata: { title: "Chord Articulations" },
      tempo: 120,
      tracks: [
        {
          events: [
            // Normal chord
            {
              time: 0,
              duration: 2,
              pitch: [60, 64, 67], // C-E-G
              velocity: 0.8
            },
            // Chord with vibrato
            {
              time: 2,
              duration: 2,
              pitch: [62, 66, 69], // D-F#-A
              velocity: 0.8,
              articulations: [
                {
                  type: "vibrato",
                  rate: 6,
                  depth: 60
                }
              ]
            },
            // Chord with tremolo
            {
              time: 4,
              duration: 2,
              pitch: [64, 68, 71], // E-G#-B
              velocity: 0.8,
              articulations: [
                {
                  type: "tremolo",
                  rate: 8,
                  depth: 0.5
                }
              ]
            }
          ]
        }
      ]
    };

    // Create players
    const player1 = createPlayer(composition1, { autoplay: false });
    const player2 = createPlayer(composition2, { autoplay: false });

    document.getElementById('player1-container').appendChild(player1);
    document.getElementById('player2-container').appendChild(player2);

    console.log('Tests loaded:');
    console.log('Test 1: FMSynth should be used for both normal and articulated notes');
    console.log('Test 2: Chords should apply articulations to each note');
  </script>
</body>
</html>
