<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>JMON Studio - Articulation Enrichment</title>
        <style>
            body {
                font-family:
                    system-ui,
                    -apple-system,
                    sans-serif;
                max-width: 1400px;
                margin: 0 auto;
                padding: 20px;
                background: #f8f9fa;
                line-height: 1.6;
            }
            h1 {
                color: #2c3e50;
            }
            .example {
                background: white;
                margin: 25px 0;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }
            .example h3 {
                margin-top: 0;
                color: #34495e;
                border-bottom: 2px solid #3498db;
                padding-bottom: 8px;
            }
            .score-container {
                border: 1px dashed #bdc3c7;
                padding: 15px;
                background: #fefefe;
                min-height: 200px;
                margin: 15px 0;
                border-radius: 4px;
            }
            .description {
                color: #7f8c8d;
                margin-bottom: 15px;
                padding: 10px;
                background: #ecf0f1;
                border-radius: 4px;
                border-left: 4px solid #3498db;
            }
            .code-example {
                background: #2c3e50;
                color: #ecf0f1;
                padding: 15px;
                border-radius: 4px;
                font-family: "Monaco", "Menlo", monospace;
                font-size: 13px;
                overflow-x: auto;
                margin: 10px 0;
            }
            button {
                background: #3498db;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                cursor: pointer;
                margin: 5px;
                font-weight: 500;
            }
            button:hover {
                background: #2980b9;
            }
            button.secondary {
                background: #95a5a6;
            }
            button.secondary:hover {
                background: #7f8c8d;
            }
            .controls {
                margin: 15px 0;
                padding: 15px;
                background: #ecf0f1;
                border-radius: 4px;
            }
            .comparison {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin: 20px 0;
            }
            @media (max-width: 800px) {
                .comparison {
                    grid-template-columns: 1fr;
                }
            }
            .info {
                font-size: 14px;
                color: #7f8c8d;
                margin-top: 10px;
                font-style: italic;
            }
        </style>
    </head>
    <body>
        <h1>ðŸŽµ JMON Studio - Articulation Enrichment</h1>
        <p>
            This demonstrates how to
            <strong>use jmon-algo to ADD articulations</strong> to existing
            musical pieces programmatically.
        </p>

        <div class="example">
            <h3>Original Piece (No Articulations)</h3>
            <div class="description">
                A simple C major melody without any articulations - the
                foundation piece we'll enrich.
            </div>
            <div class="controls">
                <button
                    onclick="renderComparison('original', 'original-score')"
                >
                    Show Original
                </button>
            </div>
            <div id="original-score" class="score-container"></div>
        </div>

        <div class="example">
            <h3>1. Add Staccato to Short Notes</h3>
            <div class="description">
                <strong>Function:</strong> <code>addStaccatoToShortNotes()</code
                ><br />
                Automatically adds staccato articulation to all quarter notes
                for a detached, bouncy feel.
            </div>
            <div class="code-example">
                const enriched = addStaccatoToShortNotes(originalPiece); // Adds
                staccato to all notes with duration "4n"
            </div>
            <div class="comparison">
                <div>
                    <button
                        onclick="renderComparison('original', 'staccato-before')"
                    >
                        Before
                    </button>
                    <div id="staccato-before" class="score-container"></div>
                </div>
                <div>
                    <button
                        onclick="renderComparison('withStaccato', 'staccato-after')"
                    >
                        After (with Staccato)
                    </button>
                    <div id="staccato-after" class="score-container"></div>
                </div>
            </div>
        </div>

        <div class="example">
            <h3>2. Add Accents to Strong Beats</h3>
            <div class="description">
                <strong>Function:</strong> <code>addAccentsToStrongBeats()</code
                ><br />
                Adds accent marks to notes falling on strong beats (beats 0, 2,
                4, 6) for rhythmic emphasis.
            </div>
            <div class="code-example">
                const enriched = addAccentsToStrongBeats(originalPiece); // Adds
                accents to notes where time % 2 === 0
            </div>
            <div class="comparison">
                <div>
                    <button
                        onclick="renderComparison('original', 'accents-before')"
                    >
                        Before
                    </button>
                    <div id="accents-before" class="score-container"></div>
                </div>
                <div>
                    <button
                        onclick="renderComparison('withAccents', 'accents-after')"
                    >
                        After (with Accents)
                    </button>
                    <div id="accents-after" class="score-container"></div>
                </div>
            </div>
        </div>

        <div class="example">
            <h3>3. Add Tenuto to Long Notes</h3>
            <div class="description">
                <strong>Function:</strong> <code>addTenutoToLongNotes()</code
                ><br />
                Applies tenuto markings to half notes and whole notes to
                emphasize their sustained character.
            </div>
            <div class="code-example">
                const enriched = addTenutoToLongNotes(originalPiece); // Adds
                tenuto to notes with duration "2n" or "1n"
            </div>
            <div class="comparison">
                <div>
                    <button
                        onclick="renderComparison('original', 'tenuto-before')"
                    >
                        Before
                    </button>
                    <div id="tenuto-before" class="score-container"></div>
                </div>
                <div>
                    <button
                        onclick="renderComparison('withTenuto', 'tenuto-after')"
                    >
                        After (with Tenuto)
                    </button>
                    <div id="tenuto-after" class="score-container"></div>
                </div>
            </div>
        </div>

        <div class="example">
            <h3>4. Add Glissando Articulations</h3>
            <div class="description">
                <strong>Function:</strong> <code>addGlissandos()</code><br />
                Adds glissando articulations using the real jmon-algo API to
                create smooth slides between notes.
            </div>
            <div class="code-example">
                const enriched = addGlissandos(originalPiece); // Uses
                jm.theory.harmony.addArticulation() with glissando and target
                pitch
            </div>
            <div class="comparison">
                <div>
                    <button
                        onclick="renderComparison('original', 'glissando-before')"
                    >
                        Before
                    </button>
                    <div id="glissando-before" class="score-container"></div>
                </div>
                <div>
                    <button
                        onclick="renderComparison('withGlissandos', 'glissando-after')"
                    >
                        After (with Glissandos)
                    </button>
                    <div id="glissando-after" class="score-container"></div>
                </div>
            </div>
        </div>

        <div class="example">
            <h3>5. Contextual Articulations</h3>
            <div class="description">
                <strong>Function:</strong>
                <code>applyContextualArticulations()</code><br />
                Intelligently applies articulations based on melodic intervals:
                accents for large leaps, legato for steps, tenuto for medium
                intervals, marcato for final note.
            </div>
            <div class="code-example">
                const enriched = applyContextualArticulations(originalPiece); //
                Analyzes melodic movement and applies appropriate articulations
            </div>
            <div class="comparison">
                <div>
                    <button
                        onclick="renderComparison('original', 'contextual-before')"
                    >
                        Before
                    </button>
                    <div id="contextual-before" class="score-container"></div>
                </div>
                <div>
                    <button
                        onclick="renderComparison('contextual', 'contextual-after')"
                    >
                        After (Contextual)
                    </button>
                    <div id="contextual-after" class="score-container"></div>
                </div>
            </div>
        </div>

        <div class="example">
            <h3>5. Expression Articulations</h3>
            <div class="description">
                <strong>Function:</strong>
                <code>addExpressionArticulations()</code><br />
                Adds vibrato to long notes and pitch bends using jmon-algo's
                complex articulation system.
            </div>
            <div class="code-example">
                const enriched = addExpressionArticulations(originalPiece); //
                Uses jm.theory.harmony.addArticulation() for vibrato and bend
                with parameters
            </div>
            <div class="comparison">
                <div>
                    <button
                        onclick="renderComparison('original', 'expression-before')"
                    >
                        Before
                    </button>
                    <div id="expression-before" class="score-container"></div>
                </div>
                <div>
                    <button
                        onclick="renderComparison('withExpression', 'expression-after')"
                    >
                        After (with Expression)
                    </button>
                    <div id="expression-after" class="score-container"></div>
                </div>
            </div>
        </div>

        <div class="example">
            <h3>6. Dynamics + Articulations</h3>
            <div class="description">
                <strong>Function:</strong>
                <code>addDynamicsAndArticulations()</code><br />
                Creates crescendo and diminuendo effects using jmon-algo's
                complex articulation API.
            </div>
            <div class="code-example">
                const enriched = addDynamicsAndArticulations(originalPiece); //
                Uses jm.theory.harmony.addArticulation() for
                crescendo/diminuendo with endVelocity
            </div>
            <div class="comparison">
                <div>
                    <button
                        onclick="renderComparison('original', 'dynamics-before')"
                    >
                        Before
                    </button>
                    <div id="dynamics-before" class="score-container"></div>
                </div>
                <div>
                    <button
                        onclick="renderComparison('withDynamics', 'dynamics-after')"
                    >
                        After (with Dynamics)
                    </button>
                    <div id="dynamics-after" class="score-container"></div>
                </div>
            </div>
        </div>

        <!-- Load libraries -->
        <script src="./dist/jmon.umd.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.2/build/umd/vexflow.min.js"></script>
        <script type="module">
            import articulationExamples from "./articulation-enrichment-examples.js";

            // Make examples available globally
            window.articulationExamples = articulationExamples;

            console.log("âœ… All libraries loaded");
        </script>

        <script>
            function renderComparison(exampleType, containerId) {
                const container = document.getElementById(containerId);
                const jm = window.JmonStudio;
                const VF = window.VF;

                if (!jm || !VF) {
                    container.innerHTML =
                        '<div style="color: red;">Libraries not loaded</div>';
                    return;
                }

                try {
                    container.innerHTML = ""; // Clear

                    let piece;
                    if (exampleType === "original") {
                        piece = window.articulationExamples.original;
                    } else if (
                        typeof window.articulationExamples[exampleType] ===
                        "function"
                    ) {
                        piece = window.articulationExamples[exampleType]();
                    } else {
                        container.innerHTML =
                            '<div style="color: red;">Example not found: ' +
                            exampleType +
                            "</div>";
                        return;
                    }

                    const result = jm.score(piece, VF, {
                        width: 600,
                        height: 160,
                        outputType: "div",
                    });

                    if (result && result.nodeType === 1) {
                        container.appendChild(result);

                        // Add analysis info
                        const articulatedNotes = piece.tracks[0].notes.filter(
                            (note) => note.articulation,
                        ).length;
                        const ornamentsCount = piece.tracks[0].notes.filter(
                            (note) => note.ornaments,
                        ).length;

                        const info = document.createElement("div");
                        info.className = "info";
                        info.innerHTML = `
                        ðŸ“Š <strong>${piece.metadata.title}</strong><br>
                        Articulated notes: ${articulatedNotes}/${piece.tracks[0].notes.length}
                        ${ornamentsCount > 0 ? `, Ornaments: ${ornamentsCount}` : ""}
                    `;
                        container.appendChild(info);
                    }
                } catch (error) {
                    console.error("Rendering error:", error);
                    container.innerHTML =
                        '<div style="color: red;">Error: ' +
                        error.message +
                        "</div>";
                }
            }

            // Auto-render original piece
            setTimeout(() => {
                renderComparison("original", "original-score");
            }, 1000);
        </script>
    </body>
</html>
